---
import { getLangFromPath, dict } from "../i18n";

const {
  mapsUrl,
  phoneE164,
  instagramUrl,
  facebookUrl,
  tripadvisorUrl,
  googleUrl,
} = Astro.props;

const url = new URL(Astro.request.url);
const lang = getLangFromPath(url.pathname);
const t = dict[lang];
---

<!-- Mobile sticky: 3 primary + More -->
<div class="fixed bottom-4 left-4 right-4 z-50 md:hidden">
  <div class="overflow-hidden rounded-2xl border border-white/10 bg-black/80 backdrop-blur-md shadow-2xl">
    <div class="grid grid-cols-4">
      <a
        href={mapsUrl}
        target="_blank"
        class="py-3 text-center text-sm font-semibold bg-white text-black"
      >
        {t.sticky.directions}
      </a>

      <a
        href={`tel:${phoneE164}`}
        class="py-3 text-center text-sm font-semibold text-white hover:bg-white/10 transition"
      >
        {t.sticky.call}
      </a>

      <a
        href={instagramUrl}
        target="_blank"
        class="py-3 text-center text-sm font-semibold text-white hover:bg-white/10 transition"
      >
        {t.sticky.instaShort}
      </a>

      <button
        type="button"
        class="py-3 text-center text-sm font-semibold text-white hover:bg-white/10 transition"
        data-more-btn
      >
        {t.sticky.more}
      </button>
    </div>

    <!-- Hidden panel -->
    <div class="hidden border-t border-white/10 bg-black/70" data-more-panel>
      <div class="grid grid-cols-2 gap-2 p-3">
        <a
          href={facebookUrl}
          target="_blank"
          class="rounded-xl border border-white/10 px-3 py-2 text-center text-sm font-semibold text-white hover:bg-white/10 transition"
        >
          {t.sticky.facebook}
        </a>

        <a
          href={tripadvisorUrl}
          target="_blank"
          class="rounded-xl border border-white/10 px-3 py-2 text-center text-sm font-semibold text-white hover:bg-white/10 transition"
        >
          {t.sticky.tripadvisor}
        </a>

        {googleUrl && (
          <a
            href={googleUrl}
            target="_blank"
            class="col-span-2 rounded-xl border border-white/10 px-3 py-2 text-center text-sm font-semibold text-white hover:bg-white/10 transition"
          >
            {t.sticky.googleReviews}
          </a>
        )}
      </div>
    </div>
  </div>
</div>

<!-- Desktop quick links -->
<div class="hidden md:block fixed bottom-6 right-6 z-50">
  <div class="flex gap-2 rounded-2xl border border-white/10 bg-black/70 backdrop-blur-md p-2 shadow-2xl">
    <a
      href={mapsUrl}
      target="_blank"
      class="rounded-xl bg-white px-4 py-2 text-sm font-semibold text-black hover:bg-white/90 transition"
    >
      {t.sticky.directions}
    </a>

    <a
      href={`tel:${phoneE164}`}
      class="rounded-xl border border-white/15 px-4 py-2 text-sm font-semibold text-white hover:bg-white/10 transition"
    >
      {t.sticky.call}
    </a>

    <a
      href={instagramUrl}
      target="_blank"
      class="rounded-xl border border-white/15 px-4 py-2 text-sm font-semibold text-white hover:bg-white/10 transition"
    >
      {t.sticky.instagram}
    </a>

    <a
      href={facebookUrl}
      target="_blank"
      class="rounded-xl border border-white/15 px-4 py-2 text-sm font-semibold text-white hover:bg-white/10 transition"
    >
      {t.sticky.facebook}
    </a>

    <a
      href={tripadvisorUrl}
      target="_blank"
      class="rounded-xl border border-white/15 px-4 py-2 text-sm font-semibold text-white hover:bg-white/10 transition"
    >
      {t.sticky.tripadvisor}
    </a>

    {googleUrl && (
      <a
        href={googleUrl}
        target="_blank"
        class="rounded-xl border border-white/15 px-4 py-2 text-sm font-semibold text-white hover:bg-white/10 transition"
      >
        {t.sticky.googleReviews}
      </a>
    )}
  </div>
</div>

<script is:inline>
  (() => {
    function initStickyCta() {
      const btn = document.querySelector("[data-more-btn]");
      const panel = document.querySelector("[data-more-panel]");

      if (!btn || !panel) return;

      btn.addEventListener("click", () => {
        panel.classList.toggle("hidden");
      });
    }

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", initStickyCta);
    } else {
      initStickyCta();
    }
  })();
</script>